<?php
/**
 * Admin interface
 *
 * @package rkv-site-guide
 */

namespace RKV\Site_Guide\Admin;

/**
 * Admin UI.
 */
class Admin {

	/**
	 * Run.
	 */
	public function run() {
		add_action( 'admin_enqueue_scripts', [ $this, 'admin_enqueue_scripts' ] );
		add_action( 'admin_menu', [ $this, 'admin_menu' ] );
	}

	/**
	 * Admin menu.
	 */
	public function admin_menu() {

		// Add our page.
		add_menu_page(
			__( 'Site Guide Articles', 'rkv-site-guide' ),
			__( 'Site Guide', 'rkv-site-guide' ),
			'edit_posts',
			'site-guide',
			[ $this, 'submenu_page_callback' ],
			'data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0nMS4wJyBlbmNvZGluZz0nVVRGLTgnPz48c3ZnIHdpZHRoPScyNXB4JyBoZWlnaHQ9JzMzcHgnIHZpZXdCb3g9JzAgMCAyNSAzMycgdmVyc2lvbj0nMS4xJyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHhtbG5zOnhsaW5rPSdodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rJz48dGl0bGU+cmt2LWxvZ28tYnVsYi13aGl0ZTwvdGl0bGU+PGcgaWQ9J1BhZ2UtMScgc3Ryb2tlPSdub25lJyBzdHJva2Utd2lkdGg9JzEnIGZpbGw9J25vbmUnIGZpbGwtcnVsZT0nZXZlbm9kZCc+PGcgaWQ9J3Jrdi1sb2dvLWJ1bGItd2hpdGUnIGZpbGwtcnVsZT0nbm9uemVybyc+PHBhdGggZD0nTTEyLjUsMjEuMjUgQzE3LjMzLDIxLjI1IDIxLjI1LDE3LjMzIDIxLjI1LDEyLjUgQzIxLjI1LDcuNjcwMDIgMTcuMzMsMy43NTAwMiAxMi41LDMuNzUwMDIgQzcuNjcsMy43NTAwMiAzLjc1LDcuNjcwMDIgMy43NSwxMi41IEMzLjc1LDE3LjMzIDcuNjcsMjEuMjUgMTIuNSwyMS4yNSBaJyBpZD0nUGF0aCcgZmlsbD0nI0ZBRTA1Myc+PC9wYXRoPjxwYXRoIGQ9J00xNi42MjUsMjggTDguMzc1LDI4IEM4LjAzLDI4IDcuNzUsMjcuNzIgNy43NSwyNy4zNzUgQzcuNzUsMjcuMDMgOC4wMywyNi43NSA4LjM3NSwyNi43NSBMMTYuNjI1LDI2Ljc1IEMxNi45NywyNi43NSAxNy4yNSwyNy4wMyAxNy4yNSwyNy4zNzUgQzE3LjI1LDI3LjcyIDE2Ljk3LDI4IDE2LjYyNSwyOCBaJyBpZD0nUGF0aCcgZmlsbD0nI0ZGRkZGRic+PC9wYXRoPjxwYXRoIGQ9J00xNi4xMjUsMzAuMjUgTDguODc1LDMwLjI1IEM4LjUzLDMwLjI1IDguMjUsMjkuOTcgOC4yNSwyOS42MjUgQzguMjUsMjkuMjggOC41MywyOSA4Ljg3NSwyOSBMMTYuMTI1LDI5IEMxNi40NywyOSAxNi43NSwyOS4yOCAxNi43NSwyOS42MjUgQzE2Ljc1LDI5Ljk3IDE2LjQ3LDMwLjI1IDE2LjEyNSwzMC4yNSBaJyBpZD0nUGF0aCcgZmlsbD0nI0ZGRkZGRic+PC9wYXRoPjxwYXRoIGQ9J00xNS42MjUsMzIuNSBMOS4zNzUsMzIuNSBDOS4wMywzMi41IDguNzUsMzIuMjIgOC43NSwzMS44NzUgQzguNzUsMzEuNTMgOS4wMywzMS4yNSA5LjM3NSwzMS4yNSBMMTUuNjI1LDMxLjI1IEMxNS45NywzMS4yNSAxNi4yNSwzMS41MyAxNi4yNSwzMS44NzUgQzE2LjI1LDMyLjIyIDE1Ljk3LDMyLjUgMTUuNjI1LDMyLjUgWicgaWQ9J1BhdGgnIGZpbGw9JyNGRkZGRkYnPjwvcGF0aD48cGF0aCBkPSdNMTQuMDUyNiwxNi42MSBDMTQuMTIyNiwxNi4zNTI1IDE0LjI1NzYsMTYuMTI3NSAxNC40MzI2LDE1Ljk1IEw4Ljc4NzU1LDEzLjkxMjUgTDE2Ljg2NTEsMTIuMjMgQzE2LjU1MjYsMTEuODY1IDE2LjQxNzYsMTEuMzU1IDE2LjU1MjYsMTAuODYgQzE2LjY0MDEsMTAuNTM1IDE2LjgzMDEsMTAuMjY1IDE3LjA3NzYsMTAuMDcyNSBMMTAuOTkyNiw3Ljg3NDk4IEMxMS4wMDc2LDguMDQyNDggMTAuOTk1MSw4LjIxNzQ4IDEwLjk0NzYsOC4zODk5OCBDMTAuODc3Niw4LjY0NzQ4IDEwLjc0MjYsOC44NzI0OCAxMC41Njc1LDkuMDQ5OTggTDE2LjIxMjYsMTEuMDg3NSBMOC4xMzI1NSwxMi43NyBDOC4zNzI1NSwxMy4wNDc1IDguNTEyNTUsMTMuNDEyNSA4LjUwMDA1LDEzLjgwNzUgQzguNDgwMDUsMTQuMjY1IDguMjU3NTUsMTQuNjY1IDcuOTI1MDUsMTQuOTI1IEwxNC4wMTAxLDE3LjEyMjUgQzEzLjk5NTEsMTYuOTU3NSAxNC4wMDUxLDE2Ljc4MjUgMTQuMDUyNiwxNi42MSBaJyBpZD0nUGF0aCcgZmlsbD0nI0ZGRkZGRic+PC9wYXRoPjxwYXRoIGQ9J00xMi41LDAgQzUuNTk3NSwwIDAsNS41OTc1IDAsMTIuNSBDMCwxNy40MTc1IDIuODQsMjEuNjY3NSA2Ljk2NzUsMjMuNzEgTDcuNSwyNS43NSBMMTcuNSwyNS43NSBMMTguMDMyNSwyMy43MSBDMjIuMTYsMjEuNjY3NSAyNSwxNy40MTc1IDI1LDEyLjUgQzI1LDUuNTk3NSAxOS40MDI1LDAgMTIuNSwwIFogTTE3LjAzNSwyMS42OTI1IEwxNi4xMTUsMjIuMTQ3NSBMMTUuODU1LDIzLjE0IEwxNS43NjI1LDIzLjUgTDEzLjEyNSwyMy4yNSBMMTMuMTI1LDIwLjAyNSBMMTQuOTE3NSwxOC4zOCBDMTQuNTA3NSwxOC4yMSAxNC4yMDUsMTcuODY1IDE0LjA3MjUsMTcuNDU3NSBMMTIuMDc1LDE5LjI4NzUgQzExLjk0NzUsMTkuNDA3NSAxMS44NzUsMTkuNTc1IDExLjg3NSwxOS43NSBMMTEuODc1LDIzLjI1IEw5LjIzNzUsMjMuNSBMOS4xNDUsMjMuMTQyNSBMOC44ODUsMjIuMTUgTDcuOTY1LDIxLjY5NSBDNC40NCwxOS45NSAyLjI1LDE2LjQyNzUgMi4yNSwxMi41IEMyLjI1LDYuODQ3NSA2Ljg0NzUsMi4yNSAxMi41LDIuMjUgQzE4LjE1MjUsMi4yNSAyMi43NSw2Ljg0NzUgMjIuNzUsMTIuNSBDMjIuNzUsMTYuNDI3NSAyMC41NiwxOS45NSAxNy4wMzUsMjEuNjkyNSBaJyBpZD0nU2hhcGUnIGZpbGw9JyNGRkZGRkYnPjwvcGF0aD48cGF0aCBkPSdNMTYuOTQ3NiwxNy4zODk5IEMxNy4xNjUxLDE2LjU4NzQgMTYuNjg1MSwxNS43Njk5IDE1Ljg5MDEsMTUuNTUyNCBDMTUuMzQ3NiwxNS40MDQ5IDE0LjgwMDEsMTUuNTc3NCAxNC40MzI2LDE1Ljk0OTkgQzE0LjI1NzYsMTYuMTI3NCAxNC4xMjI2LDE2LjM1MjQgMTQuMDUyNiwxNi42MDk5IEMxNC4wMDUxLDE2Ljc4MjQgMTMuOTk1MSwxNi45NTc0IDE0LjAxMDEsMTcuMTI3NCBDMTQuMDIwMSwxNy4yMzk5IDE0LjA0MDEsMTcuMzUyNCAxNC4wNzUxLDE3LjQ1OTkgQzE0LjIwNzYsMTcuODY3NCAxNC41MTAxLDE4LjIwOTkgMTQuOTIwMSwxOC4zODI0IEMxNC45ODI2LDE4LjQwNzQgMTUuMDQ1MSwxOC40MzI0IDE1LjExMjYsMTguNDQ5OSBDMTUuOTEyNiwxOC42NjQ5IDE2LjczMDEsMTguMTg0OSAxNi45NDc2LDE3LjM4OTkgWicgaWQ9J1BhdGgnIGZpbGw9JyNGNDYzM0EnPjwvcGF0aD48cGF0aCBkPSdNMTAuOTkyNyw3Ljg3NTA2IEMxMC45NDAyLDcuMjYyNTYgMTAuNTEyNyw2LjcyMjU2IDkuODkwMTYsNi41NTI1NiBDOS4wODc2Niw2LjMzNTA2IDguMjcwMTYsNi44MTUwNiA4LjA1MjY2LDcuNjEwMDYgQzcuODM1MTYsOC40MDUwNiA4LjMxNTE2LDkuMjM3NTYgOS4xMTAxNiw5LjQ0NzU2IEM5LjY1MjY2LDkuNTk1MDYgMTAuMjAwMiw5LjQyMjU2IDEwLjU2NzcsOS4wNTAwNiBDMTAuNzQyNyw4Ljg3MjU2IDEwLjg3NzcsOC42NDc1NiAxMC45NDc3LDguMzkwMDYgQzEwLjk5NTIsOC4yMTc1NiAxMS4wMDc3LDguMDQyNTYgMTAuOTkyNyw3Ljg3NTA2IFonIGlkPSdQYXRoJyBmaWxsPScjRjQ2MzNBJz48L3BhdGg+PHBhdGggZD0nTTE2LjU1MjQsMTAuODU5OSBDMTYuNDE3NCwxMS4zNTQ5IDE2LjU1MjQsMTEuODY0OSAxNi44NjQ5LDEyLjIyOTkgQzE3LjA1NDksMTIuNDQ5OSAxNy4zMDk5LDEyLjYxOTkgMTcuNjA5OSwxMi42OTc0IEMxOC40MTI0LDEyLjkxNDkgMTkuMjI5OSwxMi40MzQ5IDE5LjQ0NzQsMTEuNjM5OSBDMTkuNjY0OSwxMC44NDQ5IDE5LjE4NDksMTAuMDE5OSAxOC4zODk5LDkuODAyNDMgQzE3LjkxNDksOS42NzI0MyAxNy40MzQ5LDkuNzg5OTMgMTcuMDc3NCwxMC4wNzI0IEMxNi44Mjk5LDEwLjI2NDkgMTYuNjM5OSwxMC41MzQ5IDE2LjU1MjQsMTAuODU5OSBaJyBpZD0nUGF0aCcgZmlsbD0nI0Y0NjMzQSc+PC9wYXRoPjxwYXRoIGQ9J004LjUwMDAzLDEzLjgxIEM4LjUxNTAzLDEzLjQxNSA4LjM3NTAzLDEzLjA1IDguMTMyNTMsMTIuNzcyNSBDNy44NzI1MywxMi40NyA3LjQ5MjUzLDEyLjI3MjUgNy4wNjAwMywxMi4yNTI1IEM2LjIyNzUzLDEyLjIxNSA1LjUzNzUzLDEyLjg2IDUuNTAwMDMsMTMuNjkyNSBDNS40NzAwMywxNC41MTc1IDYuMTE1MDMsMTUuMjEyNSA2Ljk0MDAzLDE1LjI1IEM3LjMxMDAzLDE1LjI2MjUgNy42NTI1MywxNS4xNDI1IDcuOTIyNTMsMTQuOTMgQzguMjU3NTMsMTQuNjY3NSA4LjQ3NzUzLDE0LjI3IDguNTAwMDMsMTMuODEgWicgaWQ9J1BhdGgnIGZpbGw9JyNGNDYzM0EnPjwvcGF0aD48L2c+PC9nPjwvc3ZnPg==',
			3,
		);

		remove_menu_page( 'edit.php?post_type=site-guide' );
	}

	/**
	 * Submenu Page callback.
	 */
	public function submenu_page_callback() {
		printf(
			'<div class="wrap" id="rkv-site-guide-settings">%s</div>',
			esc_html__( 'Loadingâ€¦', 'rkv-site-guide' )
		);
	}

	/**
	 * Admin enqueue scripts.
	 *
	 * @param string $admin_page The admin page slug.
	 */
	public function admin_enqueue_scripts( $admin_page ) {
		if ( 'toplevel_page_site-guide' !== $admin_page ) {
			return;
		}

		$asset_file = RKV_SITE_GUIDE_PATH . 'dist/admin.asset.php';

		if ( ! file_exists( $asset_file ) ) {
			return;
		}

		$asset = include $asset_file;

		wp_enqueue_script(
			'rkv-site-guide-admin',
			RKV_SITE_GUIDE_URL . 'dist/admin.js',
			$asset['dependencies'],
			$asset['version'],
			array(
				'in_footer' => true,
			)
		);

		wp_enqueue_style(
			'rkv-site-guide-admin',
			RKV_SITE_GUIDE_URL . 'dist/admin.css',
			[ 'wp-edit-blocks' ],
			[],
		);
	}
}
